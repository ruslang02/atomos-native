<script>
	$("tray").append("<button name=\"clock\" style='color: #343a40' data-toggle=\"tooltip\" data-placement=\"left\" data-trigger='hover' title='Date loading...'></button>");
	fs.readJson(app.getPath("appData") + "/taskbar.json")
			.then(function(data) {
				if(data.clockPopup === undefined) {
					fs.writeJson(app.getPath("appData") + "/taskbar.json", Object.assign(data, {clockPopup: true}))
				}

				if(data.clockPopup === true) {
					let clockMenu;
					clockMenu = new BrowserWindow({
						width: 400,
						height: 258,
						type: "notification",
						frame: false,
						closable: false,
						maximizable: false,
						showOnLoad: false,
						minimizable: false,
						skipTaskbar: true,
						movable: false,
						resizable: false,
						x: x + width - 400 - 10,
						y: y + height - 258 - 28 - 10,
						show: false,
						alwaysOnTop: true,
					});
					clockMenu.loadURL("file://" + app.getAppPath() + "/sys/clockMenu/index.html");
					$("[name=clock]").on("click", function () {
						if (clockMenu.isVisible()) {
							clockMenu.hide();
							wc.send("deactivate-tray", {
								win: 'clock'
							})
						} else {
							clockMenu.show();
							clockMenu.setAlwaysOnTop(true);
							wc.send("activate-tray", {
								win: 'clock'
							})
						}
					});
					clockMenu.on('blur', function () {
						wc.send("deactivate-tray", {
							win: 'clock'
						});
						clockMenu.hide()
					});
				}
			});
	$("[name=clock]").on("contextmenu", function (e) {
		e.preventDefault();
		e.stopImmediatePropagation();
		Menu.buildFromTemplate([{
			label: "Time/Date Settings",
			click() {
				window.new("control", {
					section: "Date and Time"
				})
			}
		}, {type: 'separator'}, {
			label: "Taskbar Settings",
			click() {
				window.new("control", {
					section: "Taskbar"
				})
			}
		}]).popup();
	});
	$(function () {
		$('[data-toggle="tooltip"]').tooltip()
	});
	tick();
	setInterval(tick, 10000);
	function tick() {
		$("[name=clock]").text(new Date().toLocaleTimeString({}, {
			hour: '2-digit',
			minute: '2-digit'
		})).attr('data-original-title', new Date().toLocaleDateString());
	}
</script>